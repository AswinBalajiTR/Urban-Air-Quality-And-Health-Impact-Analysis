---
title: "**Urban Air Quality And Health Impact Analysis - EDA Project - Team 2**"
author: "Abilasha Singh, Aswin Balaji Thippa Ramesh, Lixing Pan"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---


```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(warning = F, message = F)
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

## **Dataset** : Urban Air Quality and Health Impact Dataset

### **Variable** | **Definition** 

**DateTime** | Timestamp of the recorded data.

**City** | The U.S. city where the data was recorded (e.g., Phoenix, San Diego, New York City).

**Temp_Max** | Maximum temperature for the day (°F).

**Temp_Min** | Minimum temperature for the day (°F).

**Temp_Avg** | Average temperature for the day (°F).

**Feels_Like_Max** | Maximum "feels like" temperature for the day (°F).

**Feels_Like_Min** | Minimum "feels like" temperature for the day (°F).

**Feels_Like_Avg** | Average "feels like" temperature for the day (°F).

**Dew_Point** | Dew point temperature (°F).

**Humidity** | Relative humidity percentage.

**Precipitation** | Total precipitation for the day (inches).

**Precip_Prob** | Probability of precipitation (percentage).

**Precip_Cover** | Coverage of precipitation (percentage).

**Precip_Type** | Type of precipitation (e.g., rain, snow).

**Snow** | Amount of snowfall (inches).

**Snow_Depth** | Snow depth (inches).

**Wind_Gust** | Maximum wind gust speed (mph).

**Wind_Speed** | Average wind speed (mph).

**Wind_Direction** | Wind direction (degrees).

**Pressure** | Atmospheric pressure (hPa).

**Cloud_Cover** | Cloud cover percentage.

**Visibility** | Visibility distance (miles).

**Solar_Radiation** | Solar radiation (W/m²).

**Solar_Energy** | Solar energy received (kWh).

**UV_Index** | UV index level.

**Severe_Risk** | Risk level of severe weather (e.g., low, moderate, high).

**Sunrise** | Sunrise time (HH:MM:SS).

**Sunset** | Sunset time (HH:MM:SS).

**Moon_Phase** | Phase of the moon (e.g., new moon, full moon).

**Conditions** | General weather conditions (e.g., clear, cloudy).

**Description** | Detailed description of the weather conditions.

**Icon** | Weather icon representation.

**Stations** | Weather stations reporting data.

**Source** | Data source information.

**Temp_Range** | Temperature range for the day (difference between max and min temperatures).

**Heat_Index** | Heat index value for the day.

**Severity_Score** | Score representing the severity of weather conditions.

**Condition_Code** | Code representing specific weather conditions.

**Month** | Month of the year.

**Season** | Season of the year (e.g., winter, spring).

**Day_of_Wee**k | Day of the week.

**Is_Weekend** | Indicator if the day is a weekend.

**Health_Risk_Score** | Score representing the potential health risk based on weather and air quality conditions.

```{r}
library(dplyr)
library(ezids)
library(ggplot2)
library(tidyr)
library(reshape2)
library(gridExtra)
```

## **Data Loading**
```{r}
#loading the data
df=read.csv("air_quality_health_impact_data.csv")
head(df)
```

## **Data Description and Summmary**
```{r}
#Shape of the dataset
paste("Row Count:",dim(df)[1],"Column Count:",dim(df)[2])
```

```{r}
#Structure of the dataset
str(df)
```

## **Appropriate Datatype Conversion**
```{r}
#Converting required columns as a factor variable
df$conditions <- as.factor(df$conditions)
df$description <- as.factor(df$description)
df$icon <- as.factor(df$icon)
df$source <- as.factor(df$source)
df$City <- as.factor(df$City)
df$Month <- as.factor(df$Month)
df$Season <- as.factor(df$Season)
df$Day_of_Week <- as.factor(df$Day_of_Week)
df$Is_Weekend <- as.factor(df$Is_Weekend)
```

```{r}
#Checking for datatype of every column
sapply(df, class)
```

```{r}
#summary of the dataset
summary(df)
```
## **Dropping of unwanted columns**
```{r}
#Checking for unique values in all the columns
unique_counts <- sapply(df, function(x) length(unique(x)))
unique_counts
```

```{r}
#Dropping the unwanted columns
df<- subset(df, select = -c(Season,Month,snow,snowdepth)) 
head(df)
dim(df)
```

## **Duplicates and missing values removal**
```{r}
#Checking for duplicate rows
duplicates <- df %>% duplicated() %>% sum()
print(paste("Number of duplicate rows:", duplicates))
```

```{r}
#Checking for missing values
missing_values <- colSums(is.na(df))
print(missing_values)
```

## **Outliers Removal**
```{r}
#Visualizing the outliers
numeric_cols <- df %>% select_if(is.numeric)
num_cols <- ncol(numeric_cols)

# Loop through numeric columns and create box plots
for (col in colnames(numeric_cols)) {
  boxplot(numeric_cols[[col]], 
          main = paste("Boxplot of", col), 
          ylab = col, 
          col = "lightblue", 
          border="darkblue")
}
```

```{r}
#Defining function to remove outliers using IQR approach
remove_outliers <- function(data) {
  for (col in names(data)) {
    if (is.numeric(data[[col]])) {
      Q1 <- quantile(data[[col]], 0.25)
      Q3 <- quantile(data[[col]], 0.75)
      IQR <- Q3 - Q1
      lower_bound <- Q1 - 1.5 * IQR
      upper_bound <- Q3 + 1.5 * IQR
      
      data <- data[data[[col]] >= lower_bound & data[[col]] <= upper_bound, ]
    }
  }
  return(data)
}
```

```{r}
#remove outliers by applying the function
df <- remove_outliers(df)
head(df)
```

```{r}
#Checking shape of the data after removing outliers
paste("Row Count:",dim(df)[1],"Column Count:",dim(df)[2])
```

## **Univariate Analysis**
```{r}
# Distribution of Health Risk Score
ggplot(df, aes(x = Health_Risk_Score)) +
  geom_histogram(bins = 50, fill = "#2993ae", alpha = 0.5) +
  labs(title = "Distribution of Health Risk Score", x = "Health Risk Score", y = "Frequency")
```

```{r}
paste("The majority of the population has health risk scores around 9.0, with a small subset showing elevated scores near 10.0.")
```

## **Bivariate and Multivariate Analysis**

```{r}
paste("Is there a statistically significant difference in the Health Risk Score on weekends compared to weekdays?")
  
# Separate Health Risk Scores by weekends and weekdays
weekend_scores <- df$Health_Risk_Score[df$Is_Weekend == "True"]
weekday_scores <- df$Health_Risk_Score[df$Is_Weekend == "False"]

# Display hypothesis statements
cat("Hypothesis Statements:\n")
cat("Null Hypothesis (H0): There is no significant difference in the Health Risk Score between weekends and weekdays.\n")
cat("Alternative Hypothesis (H1): There is a significant difference in the Health Risk Score between weekends and weekdays.\n\n")

t_test_result <- t.test(weekend_scores, weekday_scores, alternative = "two.sided")

# Display the t-test results
print(t_test_result)

# Interpretation
cat("\nInterpretation:\n")
if(t_test_result$p.value < 0.05) {
  cat("Reject the null hypothesis: There is a statistically significant difference in the Health Risk Score between weekends and weekdays.\n")
} else {
  cat("Fail to reject the null hypothesis: There is no statistically significant difference in the Health Risk Score between weekends and weekdays.\n")
}
```
```{r}
boxplot(Health_Risk_Score ~ Is_Weekend, data = df,
        main = "Health Risk Score Comparison: Weekends vs. Weekdays",
        xlab = "Is Weekend",
        ylab = "Health Risk Score",
        col = c("lightblue", "lightgreen"),
        border = "#202020")
```

```{r}
paste("The weak negative correlation of -0.24 suggests that higher temperatures are slightly associated with lower health risk scores, though the relationship is not strong")
```

```{r}
# Boxplot of Health Risk Score by City
ggplot(df, aes(x = City, y = Health_Risk_Score, fill = City)) +
  geom_boxplot() +
  labs(title = "City-wise Health Risk Score", x = "City", y = "Health Risk Score") +
  theme(axis.text.x = element_text(angle =90,hjust=1))
```

```{r}
# Boxplot of Windgust by City
ggplot(df, aes(x = City, y = windgust, fill = City)) +
  geom_boxplot() +
  labs(title = "City-wise windgust", x = "City", y = "Windgust") +
  theme(axis.text.x = element_text(angle =90,hjust=1))
```

```{r}
#Correlation between every columns
constant_columns <- sapply(df, function(x) length(unique(x)) == 1)
df <- df[, !constant_columns] 

#correlation matrix
cor_matrix <- cor(df[, sapply(df, is.numeric)])

# Melt the correlation matrix for plotting
melted_cor_matrix <- melt(cor_matrix)

# Correlation heatmap
ggplot(melted_cor_matrix, aes(Var1, Var2, fill = value)) +
  geom_tile(color = "black") +
  scale_fill_gradient2(low = "green", high = "violet", mid = "white", midpoint = 0, limit = c(-1, 1)) +
  labs(title = "Correlation Heatmap", x = "", y = "") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),axis.text.y = element_text(vjust=0,hjust=0))
```

```{r}
paste("Does wind gust have a significant impact on the Health Risk Score?")

paste("Correlation between windgust and Health risk :",cor(df$windgust, df$Health_Risk_Score))
plot1<-ggplot(df, aes(x = windgust, y = Health_Risk_Score)) +
  geom_point(color = "#2993ae") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Wind Gusts vs Health Risk Score", 
       x = "Wind Gust", 
       y = "Health Risk Score") +
  theme_minimal()

# Calculate correlation
paste("Correlation between severity score and Health risk :",cor(df$Severity_Score, df$Health_Risk_Score))
plot2<-ggplot(df, aes(x = Severity_Score, y = Health_Risk_Score)) +
  geom_point(color = "#2993ae") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Severity Score vs Health Risk Score", 
       x = "Severity Score", 
       y = "Health Risk Score") +
  theme_minimal()

paste("Correlation between wind speed and Health risk :",cor(df$windspeed, df$Health_Risk_Score))
plot3<-ggplot(df, aes(x = windspeed, y = Health_Risk_Score)) +
  geom_point(color = "#2993ae") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Wind speed vs Health Risk Score", 
       x = "Wind Speed", 
       y = "Health Risk Score") +
  theme_minimal()

paste("Correlation between humidity and Health risk :",cor(df$humidity, df$Health_Risk_Score))
plot4<-ggplot(df, aes(x = humidity, y = Health_Risk_Score)) +
  geom_point(color = "#2993ae") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "humidity vs Health Risk Score", 
       x = "humidity", 
       y = "Health Risk Score") +
  theme_minimal()

paste("Correlation between humidity and windgust :",cor(df$humidity, df$Health_Risk_Score))
plot5<-ggplot(df, aes(x = humidity, y = windgust)) +
  geom_point(color = "violet") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "humidity vs windgust", 
       x = "humidity", 
       y = "windgust") +
  theme_minimal()

grid.arrange(plot1, plot2,plot3,plot4,plot5, ncol =2 )
```

```{r}
paste("Correlation between visibility and Health risk :",cor(df$windgust, df$Severity_Score))
plot1<-ggplot(df, aes(x = visibility, y = Health_Risk_Score)) +
  geom_point(color = "#287743") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Visibility vs Health risk score", 
       x = "visibility", 
       y = "Health_Risk_Score") +
  theme_minimal()

# Calculate correlation
paste("Correlation between sunsetEpoch and Health risk :",cor(df$Severity_Score, df$Health_Risk_Score))
plot2<-ggplot(df, aes(x = sunsetEpoch, y = Health_Risk_Score)) +
  geom_point(color = "#287743") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Sunset Epoch vs Health Risk Score", 
       x = "Sunset Epoch", 
       y = "Health Risk Score") +
  theme_minimal()

paste("Correlation between sunriseEpoch and Health risk :",cor(df$windspeed, df$Health_Risk_Score))
plot3<-ggplot(df, aes(x = sunriseEpoch, y = Health_Risk_Score)) +
  geom_point(color = "#287743") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Sunrise Epoch vs Health Risk Score", 
       x = "Sunrise Epoch", 
       y = "Health Risk Score") +
  theme_minimal()

paste("Correlation between moonphase and Health risk :",cor(df$windspeed, df$Health_Risk_Score))
plot4<-ggplot(df, aes(x = moonphase, y = Health_Risk_Score)) +
  geom_point(color = "#287743") +
  geom_smooth(method = "lm", color = "black") + # Adds a regression line
  labs(title = "Moon phase vs Health Risk Score", 
       x = "Moon phase", 
       y = "Health Risk Score") +
  theme_minimal()

grid.arrange(plot1, plot2,plot3,plot4, ncol = 2)
```
```{r}
summary_stats <- df %>%
  group_by(City) %>%
  summarise(
    Avg_Dew_Point = mean(dew, na.rm = TRUE),
    Avg_Humidity = mean(humidity, na.rm = TRUE),
    Avg_Pressure = mean(pressure, na.rm = TRUE),
    Total_Precipitation = sum(precip, na.rm = TRUE),
    pressure_a = sum(pressure, na.rm = TRUE),
    .groups = 'drop'  # Drop grouping
  )

# Print summary statistics
print(summary_stats)

# Visualization

# 1. Average Dew Point by City
ggplot(summary_stats, aes(x = City, y = Avg_Dew_Point)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(title = "Average Dew Point by City", x = "City", y = "Average Dew Point") +
  theme_minimal()

# 2. Average Humidity by City
ggplot(summary_stats, aes(x = City, y = Avg_Humidity)) +
  geom_bar(stat = "identity", fill = "lightgreen") +
  labs(title = "Average Humidity by City", x = "City", y = "Average Humidity") +
  theme_minimal()

# 3. Total Precipitation by City
ggplot(summary_stats, aes(x = City, y = Total_Precipitation)) +
  geom_bar(stat = "identity", fill = "lightcoral") +
  labs(title = "Total Precipitation by City", x = "City", y = "Total Precipitation") +
  theme_minimal()

# 3. Pressue by City
ggplot(summary_stats, aes(x = City, y = pressure_a)) +
  geom_bar(stat = "identity", fill = "#909090") +
  labs(title = "Pressure by City", x = "City", y = "Pressure") +
  theme_minimal()
```

```{r}
paste("How does the Health Risk Score vary over dates?")
  
# Convert datetime column to Date type (if not already done)
df$datetime <- as.Date(df$datetime, format = "%d-%m-%Y")  # Adjust the format as needed

# Extract month and day
df$Month <- format(df$datetime, "%m")  # Extract month as numeric
df$Day <- format(df$datetime, "%d")  # Extract day
# Average Health Risk Score by Date
daily_summary <- df %>%
  group_by(datetime) %>%
  summarise(Average_HRS = mean(Health_Risk_Score, na.rm = TRUE))

print(head(daily_summary))  # Preview the summary
library(ggplot2)

ggplot(daily_summary, aes(x = datetime, y = Average_HRS)) +
  geom_line( color = "blue") +
  geom_point(size = 1, color = "red") +
  labs(title = "Daily Average Health Risk Score Over Time", 
       x = "Date", 
       y = "Average Health Risk Score") +
  scale_x_date(date_breaks = "2 day", date_labels = "%d %b")
```

```{r}
daily_summary <- df %>%
  group_by(City, datetime) %>%  # Group by city and date
  summarise(Average_HRS = mean(Health_Risk_Score, na.rm = TRUE))

print(head(daily_summary))  # Preview the summary

# Load ggplot2 if not already loaded
library(ggplot2)

# Plot average Health Risk Score for each city
ggplot(daily_summary, aes(x = datetime, y = Average_HRS, color = City)) +
  geom_line() +  # Line for average scores
  geom_point(size = 1) +  # Points for average scores
  labs(title = "Health Risk Score Over Time by City", 
       x = "Date", 
       y = "Average Health Risk Score") +
  scale_x_date(date_breaks = "2 day", date_labels = "%d %b") +
  theme_minimal() +  # Use a minimal theme for better visualization
  theme(legend.position = "bottom")  # Place legend at the bottom
```

